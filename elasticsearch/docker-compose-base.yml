version: "2.1"
services:
  elasticsearch-base:
    image: amazon/opendistro-for-elasticsearch:0.9.0
    # ports:
    #   - "9200:9200"
    #   - "9300:9300"
    environment:
      ELASTIC_PASSWORD: ${ELASTIC_PASSWORD}
      discovery.type: single-node
      opendistro_security.ssl.http.enabled: "false"
    volumes:
      - ./conf/log4j2.properties:/usr/share/elasticsearch/config/log4j2.properties
      - ./conf/security.yml:/usr/share/elasticsearch/plugins/opendistro_security/securityconfig/config.yml

  kibana-base:
    image: amazon/opendistro-for-elasticsearch-kibana:0.9.0
    # ports:
    #   - "5601:5601"
    environment:
      ELASTICSEARCH_URL: http://elasticsearch:9200
      ELASTICSEARCH_PRESERVEHOST: "false"
      SERVER_BASEPATH: "/kibana-app"
      SERVER_REWRITEBASEPATH: "true"
      opendistro_security.ssl.http.enabled: "false"
    volumes:
      - ./conf/security.yml:/usr/share/kibana/plugins/opendistro_security/securityconfig/config.yml
      - ./conf/kibana.yml:/usr/share/kibana/config/kibana.yml


  # es-consumer-base:
  #   image: ehealthafrica/aether-elasticsearch-consumer:1.1.2
  #   stdin_open: true
  #   ports:
  #     - "9009:9009"
  #   volumes:
  #    - ./conf:/code/conf/consumer
  #    - ./es_index:/code/es_index

  #   environment:
  #    - PYTHONUNBUFFERED=0
  #   command: start
